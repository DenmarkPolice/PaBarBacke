<head>
  <!-- Website essentials -->
  <%= stylesheet_link_tag "nav_bar" %>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <%= stylesheet_link_tag "modal" %>


    <%= javascript_include_tag('modal.js') %>
  <!-- Footer essentials -->
  <%= stylesheet_link_tag "footer" %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Payment essentials -->
  <%= csrf_meta_tags %>
  <%= stylesheet_link_tag "payments" %>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  <script src="https://js.stripe.com/v3/"></script>
  <%= tag :meta, :name => "stripe-key", :content => STRIPE_PUBLIC_KEY %>
</head>

<% if flash[:error] != nil %>
  <div class="login_fail">
    <p><%= flash[:error] %> </p>
  </div>
<% end %>

<!-- Modal with login form -->
<div id="modal" class="modal">
  <div class="modal-content">
    <%= form_with scope: :user, url: "/login", local: true do |f| %>

    <div class="input-field col s6">
      <i class="material-icons prefix">email</i>
      <%= f.label :mail %>
      <%= f.email_field :mail, :required => true %><br>
    </div>

    <div class="input-field col s6">
      <i class="material-icons prefix">account_balance_wallet</i>
      <%= f.label :password %>
      <%= f.password_field :password, :required => true %><br>
    </div>

    <%= f.submit 'Login', :class => 'modal-action modal-close btn deep-orange darken-2' %>
    <% end %>
  </div>
</div>
<body>
  <!-- Nav bar with icons -->
  <nav>
    <div class="nav-wrapper white">
      <a class="black-text padding-left logo">På Bar Backe</a>
      <ul class="right hide-on-med-and-down padding-right">
        <li><a href="/" class="black-text"><i class="material-icons left black-text">home</i>Hem</a></li>
        <li><a href="/vision" class="black-text"><i class="material-icons left">remove_red_eye</i>Vision</a></li>
        <li><a href="/items" class="black-text"><i class="material-icons left">shopping_cart</i>Produkt</a></li>
        <% if session[:user_id] == nil %>
          <li><a href="#modal" class="modal-trigger black-text"><i class="material-icons left ">person</i>Logga in</a></li>
            <li><a href="/signup" class=" black-text"><i class="material-icons left ">assignment</i>Registrera dig</a></li>
        <% else %>
          <li><a href="/logout" class="black-text"><i class=" material-icons left">exit_to_app</i>Logga ut</a></li>
        <% end %>
      </ul>
    </div>
  </nav>

  <main>
    <div>
      <div>
        <img src="<%= asset_path("samarbete.png") %>">
        <div class="cutoff"></div>
        <h3>80kr</h3>
      </div>
      <form class="grey darken-3" action="/pay/" method="POST">
        <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>
        <input type="hidden" name="token" />
        <div class="group">
          <label>
            <span>Card</span>
            <div id="card-element" class="field"></div>
          </label>
        </div>
        <div class="group">
          <label>
            <span>Address</span>
            <input id="address-line1" name="address_line1" class="field input-field" placeholder="Origovägen 32" />
          </label>
          <label>
            <span>Stad</span>
            <input id="address-city" name="address_city" class="field input-field" placeholder="Göteborg" />
          </label>
          <label>
            <span>Postnummer</span>
            <input id="address-zip" name="address_zip" class="field input-field" placeholder="43420" />
          </label>
        </div>
        <button class="btn deep-orange darken-2" type="submit">Betala</button>
        <div class="outcome">
          <div class="error"></div>
          <div class="success">
            <span class="token grey-text darken-3"></span>
          </div>
        </div>
      </form>
    </div>
  </main>

<!-- Footer with Social media and contact -->
<footer class="page-footer grey darken-3">
  <div class="container">
    <div class="row">
      <div class="col l6 s12">
        <h5 class="white-text">Sociala medier</h5>
        <ul class="fa-ul">
          <li><a href="https://www.instagram.com/pabarbackeuf/"><i class="fa fa-instagram"></i></a></li>
          <li><a href="https://www.facebook.com/pabarbackeuf/"><i class="fa fa-facebook"></i></a></li>
        </ul>
      </div>

      <div class="col l4 offset-l2 s12">
        <h5 class="white-text">Kontakta oss</h5>
        <ul>
          <li><a class="grey-text text-lighten-3">Origovägen 4</a></li>
          <li><a class="grey-text text-lighten-3">072 237 10 25</a></li>
          <li><a class="grey-text text-lighten-3">pabarbacke@gmail.com</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container">
    © 2018 På Bar Backe
    </div>
  </div>
</footer>




    <script type="text/javascript">
    // Create a Stripe client
    var stripe = Stripe($('meta[name="stripe-key"]').attr('content'));
    var elements = stripe.elements();

    var card = elements.create('card', {
      hidePostalCode: true,
      style: {
        base: {
          iconColor: '#CFD7E0',
          color: '#FFFFFF',
          lineHeight: '40px',
          fontWeight: 300,
          fontFamily: 'Helvetica Neue',
          fontSize: '15px',

          '::placeholder': {
            color: '#CFD7E0',
          },
        },
      }
    });
    card.mount('#card-element');

    function setOutcome(result) {
      var successElement = document.querySelector('.success');
      var errorElement = document.querySelector('.error');
      successElement.classList.remove('visible');
      errorElement.classList.remove('visible');

      if (result.token) {
        // In this example, we're simply displaying the token
        successElement.querySelector('.token').textContent = result.token.id;
        successElement.classList.add('visible');


        // In a real integration, you'd submit the form with the token to your backend server
        var form = document.querySelector('form');

        form.querySelector('input[name="token"]').setAttribute('value', result.token.id);
        form.submit();
      } else if (result.error) {
        errorElement.textContent = result.error.message;
        errorElement.classList.add('visible');
      }
    }

    card.on('change', function(event) {
      setOutcome(event);
    });

    document.querySelector('form').addEventListener('submit', function(e) {
      e.preventDefault();
      var options = {
        address_line1: document.getElementById('address-line1').value,
        address_city: document.getElementById('address-city').value,
        address_zip: document.getElementById('address-zip').value,
      };

      stripe.createToken(card, options).then(setOutcome);
    });
    </script>
