<head>
  <!-- Website essentials -->
  <%= stylesheet_link_tag "nav_bar" %>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Footer essentials -->
  <%= stylesheet_link_tag "footer" %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Payment essentials -->
  <%= csrf_meta_tags %>
  <%= stylesheet_link_tag "payments" %>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  <script src="https://js.stripe.com/v3/"></script>
  <%= tag :meta, :name => "stripe-key", :content => STRIPE_PUBLIC_KEY %>
</head>

<body>
  <!-- Nav bar with icons -->
  <nav>
    <div class="nav-wrapper white">
      <a class="black-text padding-left logo">På Bar Backe</a>
      <ul class="right hide-on-med-and-down padding-right">
        <li><a href="/" class="black-text"><i class="material-icons left black-text">home</i>Hem</a></li>
        <li><a href="/vision" class="black-text"><i class="material-icons left">remove_red_eye</i>Vision</a></li>
        <li><a href="/items" class="black-text"><i class="material-icons left">shopping_cart</i>Produkt</a></li>
        <% if session[:user_id] == nil %>
          <li><a href="#modal" class="modal-trigger black-text"><i class="material-icons left ">person</i>Logga in</a></li>
        <% else %>
          <li><a href="/logout" class="black-text"><i class=" material-icons left">exit_to_app</i>Logga ut</a></li>
        <% end %>
      </ul>
    </div>
  </nav>

  <main>
    <form action="/pay" method="post" id="payment-form">
      <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>
      <div class="form-row">
      <label for="card-element">
        Credit or debit card
      </label>
      <div id="card-element">
        <!-- a Stripe Element will be inserted here. -->
      </div>

      <!-- Used to display form errors -->
      <div id="card-errors"></div>
    </div>

    <button>Submit Payment</button>
  </form>
</main>

<!-- Footer with Social media and contact -->
<footer class="page-footer grey darken-3">
  <div class="container">
    <div class="row">
      <div class="col l6 s12">
        <h5 class="white-text">Sociala medier</h5>
        <ul class="fa-ul">
          <li><a href="https://www.instagram.com/pabarbackeuf/"><i class="fa fa-instagram"></i></a></li>
          <li><a href="https://www.facebook.com/pabarbackeuf/"><i class="fa fa-facebook"></i></a></li>
        </ul>
      </div>

      <div class="col l4 offset-l2 s12">
        <h5 class="white-text">Kontakta oss</h5>
        <ul>
          <li><a class="grey-text text-lighten-3">Origovägen 4</a></li>
          <li><a class="grey-text text-lighten-3">072 237 10 25</a></li>
          <li><a class="grey-text text-lighten-3">pabarbacke@gmail.com</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container">
    © 2018 På Bar Backe
    </div>
  </div>
</footer>




    <script type="text/javascript">
    //Load at first visit
    document.addEventListener("turbolinks:load", function() {
      // Create a Stripe client
      var stripe = Stripe($('meta[name="stripe-key"]').attr('content'));

      // Create an instance of Elements
      var elements = stripe.elements();

      // Custom styling can be passed to options when creating an Element.
      // (Note that this demo uses a wider set of styles than the guide below.)
      var style = {
        base: {
          color: '#32325d',
          lineHeight: '24px',
          fontFamily: 'Helvetica Neue',
          fontSmoothing: 'antialiased',
          fontSize: '16px',
          '::placeholder': {
            color: '#aab7c4'
          }
        },
        invalid: {
          color: '#fa755a',
          iconColor: '#fa755a'
        }
      };

      // Create an instance of the card Element
      var card = elements.create('card', {style: style});

      // Add an instance of the card Element into the `card-element` <div>
      card.mount('#card-element');

      // Handle real-time validation errors from the card Element.
      card.addEventListener('change', function(event) {
        const displayError = document.getElementById('card-errors');
        if (event.error) {
          displayError.textContent = event.error.message;
        } else {
          displayError.textContent = '';
        }
      });

      // Handle form submission
      var form = document.getElementById('payment-form');
      form.addEventListener('submit', function(event) {
        event.preventDefault();

        stripe.createToken(card).then(function(result) {
          if (result.error) {
            // Inform the user if there was an error
            var errorElement = document.getElementById('card-errors');
            errorElement.textContent = result.error.message;
            console.log(result.error.message);
          } else {
            // Send the token to your server
              alert(JSON.stringify(result.token));
              console.log(JSON.stringify(result.token));

        // Insert the token ID into the form so it gets submitted to the server

        var form = document.getElementById('payment-form');
        var hiddenInput = document.createElement('input');
        hiddenInput.setAttribute('type', 'hidden');
        hiddenInput.setAttribute('name', 'stripeToken');
        hiddenInput.setAttribute('value', result.token.id);
        form.appendChild(hiddenInput);
        alert(result.token.id);
        alert('submitting form');
        // Submit the form
        form.submit();

          }
        });
      });
    })
    </script>
